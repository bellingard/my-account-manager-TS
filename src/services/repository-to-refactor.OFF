import * as _ from 'lodash'

export default class Repo {

  /**
   * Initialize the repo:
   * - counters to create new entities
   */
  init() {
    if (this.isLoaded()) {
      this.counters = {}
    }
  }

  isLoaded() {
    return this.storage.repo != null
  }




// IN ACCOUNTS

  getAccountBalance(accountId) {
    return _.chain(this.transactions())
      .filter(t => accountId === t.fromId || accountId === t.toId)
      .map(t => (accountId === t.toId ? t.amount : -t.amount))
      .reduce((a, b) => a + b, 0)
      .value()
  }



// IN STORAGE?

  /**
   * Returns true if some staged transactions have not been categorized yet.
   */
  hasNotClassifiedStagedTransaction() {
    for (let t of this.transactions()) {
      if (t.stagedDesc && t.fromId === '') {
        return true
      }
    }
    return false
  }


}
